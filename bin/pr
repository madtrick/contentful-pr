#!/usr/bin/env node

'use strict';

var optimist = require('optimist');
var fs       = require('fs');
var homedir  = require('home-dir');
var configurationValidator = require('../lib/configuration-validator');

var CONFIG_FILE_PATH = '.contentful-pr';
var argv             = optimist.argv;
var options          = {
  base     : argv.base,
  template : argv.template,
  'tp-id'  : argv['tp-id'],
  assignee : argv.assignee
};

fs.readFile(homedir(CONFIG_FILE_PATH), function (err, data) {
  var logger = require('../lib/logging').logger({verbose: argv.verbose});
  var config;

  if (!data) {
    throw new Error('Missing config file');
  }

  config = JSON.parse(data);

  if (!configurationValidator(config)) {
    logger.error('Some of the configuration parameters are invalid');
    return;
  }

  require('..')(config, options);
});
